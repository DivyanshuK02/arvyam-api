# .env.example — Phase 3.1 Environment Configuration
# Copy to .env and fill in values

# ============================================================
# Database (Supabase)
# ============================================================
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-service-role-key

# ============================================================
# Authentication
# ============================================================
# REQUIRED: Random 32+ character string for JWT signing
# Generate with: openssl rand -base64 32
JWT_SECRET=your-secret-key-at-least-32-characters-long

# JWT expiry in hours (default: 24)
JWT_EXPIRY_HOURS=24

# ============================================================
# OTP Provider
# ============================================================
# Options: stub (dev only), resend, sendgrid
# WARNING: Never use "stub" in production!
OTP_PROVIDER=stub

# API key for your OTP provider (required for resend/sendgrid)
OTP_API_KEY=your-otp-provider-api-key

# For Resend: sender email
OTP_FROM_EMAIL=noreply@yourdomain.com

# ============================================================
# Feature Flags (all OFF by default)
# ============================================================
# Enable auth endpoints (/auth/request-otp, /auth/verify-otp)
AUTH_ENDPOINTS_ENABLED=off

# Enable privacy endpoints (/forget-me, /export-data, /profile)
MEMORY_ENDPOINTS_ENABLED=off

# Enable memory context building
MEMORY_CONTEXT_ENABLED=off

# Enable post-selection reranking
MEMORY_RERANK_ENABLED=off

# ============================================================
# Rate Limiting
# ============================================================
# Default rate limit per minute (for /api/curate, /api/refine)
RATE_LIMIT_PER_MIN=20

# ============================================================
# Production Checklist
# ============================================================
# Before enabling in production:
#
# 1. Database:
#    □ Run migrations/001_phase_3_1.sql in Supabase
#    □ Verify tables: users, orders, recipient_profiles, otp_codes
#    □ Check RLS policies are applied
#
# 2. Authentication:
#    □ Generate strong JWT_SECRET (32+ chars)
#    □ Set OTP_PROVIDER to resend or sendgrid (NOT stub)
#    □ Configure OTP_API_KEY and OTP_FROM_EMAIL
#
# 3. Feature Flags:
#    □ Enable AUTH_ENDPOINTS_ENABLED first
#    □ Test OTP flow works end-to-end
#    □ Enable MEMORY_ENDPOINTS_ENABLED for DSAR compliance
#    □ Enable MEMORY_CONTEXT_ENABLED for personalization
#    □ Enable MEMORY_RERANK_ENABLED last (after invariance testing)
#
# 4. Monitoring:
#    □ Set up log aggregation (no raw PII in logs)
#    □ Configure retention job cron (02:00 IST daily)
#    □ Monitor rate limit hits
#
# 5. Compliance:
#    □ Verify /forget-me cascade works
#    □ Verify /export-data returns complete user data
#    □ Test guest checkout still works
